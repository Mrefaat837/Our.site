<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>المصحف الإلكتروني | Mohamed Refaat</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Amiri', serif; background: #fdf6e3; color: #000; margin:0; padding:0; }
  header { text-align:center; padding:20px; background:#b71c1c; color:white; }
  h1 { margin:0; }
  select, input { padding:8px 12px; margin:5px; border-radius:6px; border:1px solid #aaa; font-size:16px; }
  #searchBox { width:60%; }
  #quranContainer { padding:20px; max-width:900px; margin:auto; line-height:2; }
  .ayah { margin-bottom:10px; font-size:22px; }
  .ayah span { display:inline-block; }
  .red { color:#e63946; }   /* مثال ألوان التجويد */
  .green { color:#2a9d8f; }
  .blue { color:#264653; }
  .navBtns { text-align:center; margin:15px 0; }
  button { padding:8px 12px; margin:3px; border:none; border-radius:6px; background:#b71c1c; color:white; cursor:pointer; }
  button:hover { background:#880e4f; }
  section { max-width:900px; margin:20px auto; }
  .books { background:#f4a261; padding:15px; border-radius:10px; margin-top:20px; }
</style>
</head>
<body>

<header>
  <h1>المصحف الإلكتروني</h1>
  <div>
    <select id="surahSelect"></select>
    <input type="number" id="ayahInput" placeholder="رقم الآية">
    <button onclick="goToAyah()">اذهب</button>
    <input type="text" id="searchBox" placeholder="بحث عن نص">
    <button onclick="searchAyah()">بحث</button>
  </div>
</header>

<div class="navBtns">
  <button onclick="prevAyah()">الآية السابقة</button>
  <button onclick="nextAyah()">الآية التالية</button>
  <button onclick="prevSurah()">السورة السابقة</button>
  <button onclick="nextSurah()">السورة التالية</button>
</div>

<div id="quranContainer">تحميل المصحف...</div>

<section>
  <h2>الكتب الدينية</h2>
  <div id="booksContainer" class="books">
    <p>هنا ستظهر الكتب الدينية لاحقًا.</p>
  </div>
  <button onclick="addBook()">أضف كتاب</button>
</section>

<script>
let quranData = [];
let currentSurahIndex = 0;
let currentAyahIndex = 0;

// تحميل كل سور المصحف محليًا
async function loadLocalQuran(){
  for(let i=1; i<=114; i++){
    try {
      const res = await fetch(`surah/surah${i}.json`);
      const surah = await res.json();
      quranData.push(surah);
    } catch(err){
      console.error("Error loading surah", i, err);
    }
  }
  populateSurahSelect();
  renderAyah();
}

loadLocalQuran();

// ملء قائمة السور
function populateSurahSelect(){
  const sel = document.getElementById("surahSelect");
  quranData.forEach((s,i)=>{
    const opt = document.createElement("option");
    opt.value=i;
    opt.text=s.name;
    sel.appendChild(opt);
  });
  sel.addEventListener("change",(e)=>{
    currentSurahIndex=parseInt(e.target.value);
    currentAyahIndex=0;
    renderAyah();
  });
}

// عرض الآيات
function renderAyah(){
  if(!quranData.length) return;
  const container = document.getElementById("quranContainer");
  const surah = quranData[currentSurahIndex];
  container.innerHTML = "";
  surah.ayahs.forEach((ayah,i)=>{
    const ay = document.createElement("div");
    ay.className="ayah";
    ay.innerHTML = `<span class="blue">(${i+1})</span> ${ayah.text}`;
    container.appendChild(ay);
  });
}

// الذهاب لآية محددة
function goToAyah(){
  const ayahInput = parseInt(document.getElementById("ayahInput").value)-1;
  if(!isNaN(ayahInput) && ayahInput>=0 && ayahInput<quranData[currentSurahIndex].ayahs.length){
    currentAyahIndex=ayahInput;
    const container = document.getElementById("quranContainer");
    const target = container.children[currentAyahIndex];
    if(target) target.scrollIntoView({behavior:"smooth"});
  }
}

// البحث في المصحف
function searchAyah(){
  const text = document.getElementById("searchBox").value.trim();
  if(!text) return;
  const container = document.getElementById("quranContainer");
  container.innerHTML="";
  quranData.forEach((surah)=>{
    surah.ayahs.forEach((ayah,i)=>{
      if(ayah.text.includes(text)){
        const ay = document.createElement("div");
        ay.className="ayah";
        ay.innerHTML = `<span class="blue">(${i+1}) ${surah.name}:</span> ${ayah.text}`;
        container.appendChild(ay);
      }
    });
  });
}

// أزرار التنقل بين الآيات والسور
function nextAyah(){
  if(currentAyahIndex < quranData[currentSurahIndex].ayahs.length-1){
    currentAyahIndex++;
    goToAyah();
  }
}
function prevAyah(){
  if(currentAyahIndex >0){
    currentAyahIndex--;
    goToAyah();
  }
}
function nextSurah(){
  if(currentSurahIndex < quranData.length-1){
    currentSurahIndex++;
    currentAyahIndex=0;
    renderAyah();
  }
}
function prevSurah(){
  if(currentSurahIndex>0){
    currentSurahIndex--;
    currentAyahIndex=0;
    renderAyah();
  }
}

// الكتب الدينية
function addBook(){
  const title = prompt("اسم الكتاب:");
  const desc = prompt("الوصف:");
  const container = document.getElementById("booksContainer");
  if(title && desc){
    const div = document.createElement("div");
    div.style.background="#fff";
    div.style.margin="5px";
    div.style.padding="8px";
    div.style.borderRadius="6px";
    div.innerHTML=`<strong>${title}</strong><p>${desc}</p>`;
    container.appendChild(div);
  }
}
</script>

</body>
</html>

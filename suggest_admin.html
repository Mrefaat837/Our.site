<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | Mohamed Refaat</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{--primary:#e63946;--secondary:#b71c1c;--light:#fceae9;--dark:#2b0a0a;}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:var(--light);color:var(--dark);}
header{min-height:120px;background:linear-gradient(135deg,var(--secondary),var(--primary));color:#fff;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:20px;}
header h1{font-size:2.6rem;margin-bottom:10px;}
#sidebar{position: fixed; left:-280px; top:0; width:280px; height:100%; background: var(--primary); color:#fff; padding:90px 25px; transition:0.5s; z-index:1000; overflow-y:auto;}
#sidebar h3{ font-size:24px; margin-bottom:20px;}
#sidebar ul{ list-style:none; font-size:18px; line-height:2.5; }
#sidebar ul li a{ color:white; text-decoration:none; display:flex; align-items:center; gap:8px;}
#toggleSidebarBtn{position: fixed; top:80px; left:20px; z-index:1002; padding:14px 18px; border-radius:12px; border:none; background: var(--secondary); color:white; font-size:26px; cursor:pointer;}
.container{max-width:1200px;margin:140px auto 50px;padding:0 20px; display:grid; grid-template-columns:2fr 3fr; gap:30px;}
.window{background:#fff;padding:20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.1);overflow:auto;max-height:600px;}
.window h3{text-align:center;margin-bottom:15px;}
ul{list-style:none;padding-left:0;}
li{margin-bottom:15px;padding:12px;border-bottom:1px solid #eee;}
li strong{font-size:1.1rem;}
li .time{display:block;margin-top:6px;font-size:0.85rem;color:#777;}
.top-right{display:flex;flex-direction:column;gap:15px;}
</style>
</head>
<body>

<!-- ğŸ” Admin Password -->
<script>
const ADMIN_PASSWORD="12345";
const pass=prompt("Enter admin password:");
if(pass!==ADMIN_PASSWORD){
  document.body.innerHTML=`<div style="height:100vh;display:flex;justify-content:center;align-items:center;font-size:2rem;font-weight:700;color:#b71c1c;">ğŸš« Access Denied</div>`;
  throw new Error("Access denied");
}
</script>

<div id="sidebar">
<h3>ğŸ“š Dashboard</h3>
<ul>
<li><a href="index.html">ğŸ  Home</a></li>
    <li><a href="year1.html">ğŸ©º Year 1</a></li>
    <li><a href="year2.html">ğŸ“– Year 2</a></li>
    <li><a href="year3.html">ğŸ¥ Year 3</a></li>
    <li><a href="deen.html">ğŸ•Œ Islamic Routine</a></li>
    <li><a href="calc.html">ğŸ§® Medical Calculators</a></li>
    <li><a href="tasks.html">ğŸ’ª Tasks</a></li>
    <li><a href="brainwork.html">ğŸ§  Brain Work</a></li>
    <li><a href="suggest.html">ğŸ’¡ Suggestions</a></li>
    <li><a href="suggest_admin.html">ğŸ”’ Admin</a></li>
</ul>
</div>
<button id="toggleSidebarBtn">â˜°</button>

<header>
<h1>Admin Dashboard</h1>
<p>All Data from Firebase</p>
</header>

<div class="container">

<!-- Left Column: Suggestions + Failed -->
<div class="window" id="suggestionsWindow">
<h3>ğŸ’¡ Suggestions</h3>
<ul id="suggestionsList"></ul>
<h3>ğŸš« Failed Login Attempts</h3>
<ul id="failedList"></ul>
</div>

<!-- Right Column: Top Active + Registered Users -->
<div class="top-right">
<div class="window" id="topActiveWindow">
<h3>ğŸ”¥ Top Active Users</h3>
<ul id="topActiveList"></ul>
</div>

<div class="window" id="registeredWindow">
<h3>âœ… Registered Users</h3>
<ul id="registeredList"></ul>
</div>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig={
apiKey:"AIzaSyCaMUN2J922Uer9xGfhrBbrnlBNp2YljP0",
authDomain:"mrefaat-2548a.firebaseapp.com",
projectId:"mrefaat-2548a",
storageBucket:"mrefaat-2548a.firebasestorage.app",
messagingSenderId:"731800029782",
appId:"1:731800029782:web:ec5c36eb8858e990eb49f7",
measurementId:"G-6DQ87V5H92"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

/* Toggle Sidebar */
const sidebar=document.getElementById('sidebar');
document.getElementById('toggleSidebarBtn').onclick=()=>{sidebar.style.left=sidebar.style.left==='0px'?'-280px':'0px';};

/* Suggestions */
const suggestionsList=document.getElementById('suggestionsList');
db.collection('suggestions').orderBy('timestamp','desc').onSnapshot(snapshot=>{
  suggestionsList.innerHTML='';
  snapshot.forEach(doc=>{
    const d=doc.data();
    const time=d.timestamp?d.timestamp.toDate().toLocaleString():'';
    const li=document.createElement('li');
    li.innerHTML=`<strong>${d.name}</strong> (${d.deviceId})<br>${d.suggestion}<span class="time">${time}</span>`;
    suggestionsList.appendChild(li);
  });
});

/* Failed Attempts */
const failedList=document.getElementById('failedList');
db.collection('failed_attempts').orderBy('time','desc').onSnapshot(snapshot=>{
  failedList.innerHTML='';
  snapshot.forEach(doc=>{
    const d=doc.data();
    const time=d.time?d.time.toDate().toLocaleString():'';
    const li=document.createElement('li');
    li.innerHTML=`<strong>${d.deviceId}</strong> wrote: ${d.answer}<span class="time">${time}</span>`;
    failedList.appendChild(li);
  });
});

/* Registered Users */
const registeredList=document.getElementById('registeredList');
db.collection('users').orderBy('firstVisit','asc').onSnapshot(snapshot=>{
  registeredList.innerHTML='';
  snapshot.forEach(doc=>{
    const d=doc.data();
    const visits=d.visitsCount||0;
    const lastVisit=d.lastVisit?d.lastVisit.toDate().toLocaleString():'';
    const durationSec=d.totalDuration||0;
    const li=document.createElement('li');
    li.innerHTML=`<strong>${d.name}</strong> | ID: ${d.deviceId}<br>Visits: ${visits} | Last: ${lastVisit} | Duration: ${durationSec} sec`;
    registeredList.appendChild(li);
  });
});

/* Top Active Users (by visitsCount) */
const topActiveList=document.getElementById('topActiveList');
db.collection('users').orderBy('visitsCount','desc').limit(10).onSnapshot(snapshot=>{
  topActiveList.innerHTML='';
  snapshot.forEach(doc=>{
    const d=doc.data();
    const visits=d.visitsCount||0;
    const lastVisit=d.lastVisit?d.lastVisit.toDate().toLocaleString():'';
    const durationSec=d.totalDuration||0;
    const li=document.createElement('li');
    li.innerHTML=`<strong>${d.name}</strong> | ID: ${d.deviceId}<br>Visits: ${visits} | Last: ${lastVisit} | Duration: ${durationSec} sec`;
    topActiveList.appendChild(li);
  });
});
</script>
</body>
</html>

